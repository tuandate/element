"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[4813],{"./node_modules/matrix-react-sdk/res/img/element-icons/cancel-rounded.svg":(e,t,s)=>{s.d(t,{I:()=>i});var o,n=s("./node_modules/react/index.js");function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o])}return e},r.apply(this,arguments)}var a=function(e,t){return n.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 10 10",role:"presentation","aria-hidden":!0,ref:t},e),o||(o=n.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeWidth:1.6,d:"m1 1 8 8M9.001 1l-8 8"})))},i=(0,n.forwardRef)(a)},"./node_modules/matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx":(e,t,s)=>{s.d(t,{J:()=>u});var o=s("./node_modules/@babel/runtime/helpers/esm/extends.js"),n=s("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),r=s("./node_modules/react/index.js"),a=s("./node_modules/classnames/index.js"),i=s.n(a),l=s("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleTooltipButton.tsx"),m=s("./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx"),c=s("./node_modules/matrix-react-sdk/src/components/views/context_menus/IconizedContextMenu.tsx");const d=["title","children","className","iconClassName","inputRef"],u=e=>{let{title:t,children:s,className:a,iconClassName:u,inputRef:_}=e,p=(0,n.A)(e,d);return!!(0,r.useContext)(m.ZF)?r.createElement(c.R$,(0,o.A)({},p,{iconClassName:u,label:t,inputRef:_})):r.createElement(l.A,(0,o.A)({},p,{title:t,className:i()(a,u),ref:_}),s)}},"./node_modules/matrix-react-sdk/src/components/views/rooms/EmojiButton.tsx":(e,t,s)=>{s.d(t,{h:()=>u});var o=s("./node_modules/@babel/runtime/helpers/esm/extends.js"),n=s("./node_modules/classnames/index.js"),r=s.n(n),a=s("./node_modules/react/index.js"),i=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),l=s("./node_modules/matrix-react-sdk/src/components/structures/ContextMenu.tsx"),m=s("./node_modules/matrix-react-sdk/src/components/views/emojipicker/EmojiPicker.tsx"),c=s("./node_modules/matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx"),d=s("./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx");function u({addEmoji:e,menuPosition:t,className:s}){const n=(0,a.useContext)(d.ZF),[u,_,p,x]=(0,l.EF)();let h=null;if(u&&_.current){const s=null!=t?t:(0,l.qv)(_.current.getBoundingClientRect()),r=()=>{x(),null==n||n()};h=a.createElement(l.Ay,(0,o.A)({},s,{onFinished:r,managed:!1}),a.createElement(m.Ay,{onChoose:e,onFinished:r}))}const g=r()("mx_EmojiButton",s,{mx_EmojiButton_highlight:u});return a.createElement(a.Fragment,null,a.createElement(c.J,{className:g,iconClassName:"mx_EmojiButton_icon",onClick:p,title:(0,i._t)("common|emoji"),inputRef:_}),h)}},"./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx":(e,t,s)=>{s.d(t,{Ay:()=>J,ZF:()=>A});var o=s("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("./node_modules/@babel/runtime/helpers/esm/extends.js"),r=s("./node_modules/classnames/index.js"),a=s.n(r),i=s("./node_modules/matrix-js-sdk/src/matrix.ts"),l=s("./node_modules/react/index.js"),m=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),c=s("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleTooltipButton.tsx"),d=s("./node_modules/matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx"),u=s("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),_=s("./node_modules/matrix-react-sdk/src/components/views/dialogs/ErrorDialog.tsx"),p=s("./node_modules/matrix-react-sdk/src/components/views/location/index.tsx"),x=s("./node_modules/matrix-react-sdk/src/Modal.tsx"),h=s("./node_modules/matrix-react-sdk/src/components/views/elements/PollCreateDialog.tsx"),g=s("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),C=s("./node_modules/matrix-react-sdk/src/ContentMessages.ts"),v=s("./node_modules/matrix-react-sdk/src/contexts/MatrixClientContext.tsx"),k=s("./node_modules/matrix-react-sdk/src/contexts/RoomContext.ts"),y=s("./node_modules/matrix-react-sdk/src/hooks/useDispatcher.ts"),f=s("./node_modules/matrix-react-sdk/src/utils/BrowserWorkarounds.ts"),E=s("./node_modules/matrix-react-sdk/src/components/views/context_menus/IconizedContextMenu.tsx"),w=s("./node_modules/matrix-react-sdk/src/components/views/rooms/EmojiButton.tsx"),b=s("./node_modules/matrix-react-sdk/src/utils/arrays.ts"),M=s("./node_modules/matrix-react-sdk/src/hooks/useSettings.ts");const A=(0,l.createContext)(null);function N(e){return l.createElement(w.h,{key:"emoji_button",addEmoji:e.addEmoji,menuPosition:e.menuPosition,className:"mx_MessageComposer_button"})}function P(){return l.createElement(j,{key:"controls_upload"})}const U=(0,l.createContext)(null),B=({roomId:e,relation:t,children:s})=>{const o=(0,l.useContext)(v.Ay),n=(0,l.useContext)(k.Ay),r=(0,l.useRef)(null),a=()=>{var e;null!=o&&o.isGuest()?u.Ay.dispatch({action:"require_registration"}):null===(e=r.current)||void 0===e||e.click()};(0,y.F)(u.Ay,(e=>{n.timelineRenderingType===e.context&&"upload_file"===e.action&&a()}));return l.createElement(U.Provider,{value:a},s,l.createElement("input",{ref:r,type:"file",style:{display:"none"},multiple:!0,onClick:f.e,onChange:s=>{var r;0!==(null===(r=s.target.files)||void 0===r?void 0:r.length)&&(C.Ay.sharedInstance().sendContentListToRoom(Array.from(s.target.files),e,t,o,n.timelineRenderingType),s.target.value="")}}))},j=()=>{const e=(0,l.useContext)(A),t=(0,l.useContext)(U);return l.createElement(d.J,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_upload",onClick:()=>{null==t||t(),null==e||e()},title:(0,m._t)("common|attachment")})};function S(e){return e.showStickersButton?l.createElement(d.J,{id:"stickersButton",key:"controls_stickers",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_stickers",onClick:()=>e.setStickerPickerOpen(!e.isStickerPickerOpen),title:e.isStickerPickerOpen?(0,m._t)("composer|close_sticker_picker"):(0,m._t)("common|sticker")}):null}const R=e=>e.showVoiceBroadcastButton?l.createElement(d.J,{key:"start_voice_broadcast",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceBroadcast",onClick:e.onStartVoiceBroadcastClick,title:(0,m._t)("voice_broadcast|action")}):null;function I(e,t){return t?null:l.createElement(d.J,{key:"voice_message_send",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceMessage",onClick:e.onRecordStartEndClick,title:(0,m._t)("composer|voice_message_button")})}function T(e,t){return l.createElement(O,{key:"polls",room:e,relation:t})}class O extends l.PureComponent{constructor(...e){super(...e),(0,o.A)(this,"context",void 0),(0,o.A)(this,"onCreateClick",(()=>{var e;null===(e=this.context)||void 0===e||e.call(this);if(this.props.room.currentState.maySendEvent(i.M_POLL_START.name,g.J.safeGet().getSafeUserId())){var t;const e=(null===(t=this.props.relation)||void 0===t?void 0:t.rel_type)===i.THREAD_RELATION_TYPE.name?this.props.relation.event_id:void 0;x.Ay.createDialog(h.A,{room:this.props.room,threadId:e},"mx_CompoundDialog",!1,!0)}else x.Ay.createDialog(_.A,{title:(0,m._t)("composer|poll_button_no_perms_title"),description:(0,m._t)("composer|poll_button_no_perms_description")})}))}render(){var e;return(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===i.THREAD_RELATION_TYPE.name?null:l.createElement(d.J,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_poll",onClick:this.onCreateClick,title:(0,m._t)("composer|poll_button")})}}function D(e,t,s){const o=t.getMember(s.getSafeUserId());return e.showLocationButton&&o?l.createElement(p.Uo,{key:"location",roomId:t.roomId,relation:e.relation,sender:o,menuPosition:e.menuPosition}):null}function F({isRichTextEnabled:e,onClick:t}){const s=e?(0,m._t)("composer|mode_plain"):(0,m._t)("composer|mode_rich_text");return l.createElement(d.J,{className:"mx_MessageComposer_button",iconClassName:a()({mx_MessageComposer_plain_text:!e,mx_MessageComposer_rich_text:e}),onClick:t,title:s})}(0,o.A)(O,"contextType",A);const J=e=>{const t=(0,l.useContext)(v.Ay),{room:s,narrow:o}=(0,l.useContext)(k.Ay),r=(0,M.t)("feature_wysiwyg_composer");if(!t||!s||e.haveRecording)return null;let i,d;o?(i=[r?l.createElement(F,{key:"composerModeButton",isRichTextEnabled:e.isRichTextEnabled,onClick:e.onComposerModeClick}):N(e)],d=[P(),S(e),I(e,o),R(e),e.showPollsButton?T(s,e.relation):null,D(e,s,t)]):(i=[r?l.createElement(F,{key:"composerModeButton",isRichTextEnabled:e.isRichTextEnabled,onClick:e.onComposerModeClick}):N(e),P()],d=[S(e),I(e,o),R(e),e.showPollsButton?T(s,e.relation):null,D(e,s,t)]),i=(0,b.Bo)(i),d=(0,b.Bo)(d);const u=a()({mx_MessageComposer_button:!0,mx_MessageComposer_buttonMenu:!0,mx_MessageComposer_closeButtonMenu:e.isMenuOpen});return l.createElement(B,{roomId:s.roomId,relation:e.relation},i,d.length>0&&l.createElement(c.A,{className:u,onClick:e.toggleButtonMenu,title:(0,m._t)("quick_settings|sidebar_settings")}),e.isMenuOpen&&l.createElement(E.Ay,(0,n.A)({onFinished:e.toggleButtonMenu},e.menuPosition,{wrapperClassName:"mx_MessageComposer_Menu",compact:!0}),l.createElement(A.Provider,{value:e.toggleButtonMenu},l.createElement(E.tx,null,d))))}},"./node_modules/matrix-react-sdk/src/stores/OwnProfileStore.ts":(e,t,s)=>{s.d(t,{V:()=>p});var o,n=s("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("./node_modules/matrix-js-sdk/src/matrix.ts"),a=s("./node_modules/lodash/lodash.js"),i=s("./node_modules/matrix-react-sdk/src/stores/AsyncStoreWithClient.ts"),l=s("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),m=s("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),c=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),d=s("./node_modules/matrix-react-sdk/src/customisations/Media.ts");const u="mx_profile_displayname",_="mx_profile_avatar_url";class p extends i.r{constructor(){super(l.Ay,{displayName:window.localStorage.getItem(u)||void 0,avatarUrl:window.localStorage.getItem(_)||void 0}),(0,n.A)(this,"monitoredUser",null),(0,n.A)(this,"onProfileUpdate",(0,a.throttle)((async()=>{if(!this.matrixClient)return;let e={displayname:void 0,avatar_url:void 0};try{e=await this.matrixClient.getProfileInfo(this.matrixClient.getSafeUserId())}catch(e){if(!(e instanceof r.MatrixError)||"M_NOT_FOUND"!==e.errcode)throw e}e.displayname?window.localStorage.setItem(u,e.displayname):window.localStorage.removeItem(u),e.avatar_url?window.localStorage.setItem(_,e.avatar_url):window.localStorage.removeItem(_),await this.updateState({displayName:e.displayname,avatarUrl:e.avatar_url,fetchedAt:Date.now()})}),200,{trailing:!0,leading:!0})),(0,n.A)(this,"onStateEvents",(async e=>{const t=m.J.safeGet().getUserId();e.getType()===r.EventType.RoomMember&&e.getSender()===t&&e.getStateKey()===t&&await this.onProfileUpdate()}))}static get instance(){return p.internalInstance}get displayName(){return this.matrixClient?this.matrixClient.isGuest()?(0,c._t)("common|guest"):this.state.displayName?this.state.displayName:this.matrixClient.getUserId():this.state.displayName||null}get isProfileInfoFetched(){return!!this.state.fetchedAt}get avatarMxc(){return this.state.avatarUrl||null}getHttpAvatarUrl(e=0){if(!this.avatarMxc)return null;const t=(0,d.lH)(this.avatarMxc);return!e||e<=0?t.srcHttp:t.getSquareThumbnailHttp(e)}async onNotReady(){var e;this.onProfileUpdate.cancel(),this.monitoredUser&&(this.monitoredUser.removeListener(r.UserEvent.DisplayName,this.onProfileUpdate),this.monitoredUser.removeListener(r.UserEvent.AvatarUrl,this.onProfileUpdate)),null===(e=this.matrixClient)||void 0===e||e.removeListener(r.RoomStateEvent.Events,this.onStateEvents),await this.reset({})}async onReady(){if(!this.matrixClient)return;const e=this.matrixClient.getSafeUserId();this.monitoredUser=this.matrixClient.getUser(e),this.monitoredUser&&(this.monitoredUser.on(r.UserEvent.DisplayName,this.onProfileUpdate),this.monitoredUser.on(r.UserEvent.AvatarUrl,this.onProfileUpdate)),this.matrixClient.on(r.RoomStateEvent.Events,this.onStateEvents),await this.onProfileUpdate()}async onAction(e){}}o=p,(0,n.A)(p,"internalInstance",(()=>{const e=new o;return e.start(),e})())}}]);
//# sourceMappingURL=4813.js.map