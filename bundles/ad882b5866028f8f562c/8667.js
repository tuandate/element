"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[8667,6288],{"./node_modules/matrix-react-sdk/res/img/element-icons/minus-button.svg":(e,t,o)=>{o.d(t,{I:()=>i});var n,a=o("./node_modules/react/index.js");function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},r.apply(this,arguments)}var s=function(e,t){return a.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0,ref:t},e),n||(n=a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M2 8c0-.432.35-.783.783-.783h10.434a.783.783 0 1 1 0 1.566H2.783A.783.783 0 0 1 2 8",clipRule:"evenodd"})))},i=(0,a.forwardRef)(s)},"./node_modules/matrix-react-sdk/res/img/image-view/close.svg":(e,t,o)=>{o.d(t,{I:()=>i});var n,a=o("./node_modules/react/index.js");function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},r.apply(this,arguments)}var s=function(e,t){return a.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 12 12",role:"presentation","aria-hidden":!0,ref:t},e),n||(n=a.createElement("path",{fill:"#A9B2BC",fillRule:"evenodd",d:"M11.468 2.04A1 1 0 0 0 10.054.627L6.047 4.633 1.811.398A1 1 0 1 0 .397 1.812l4.236 4.236-4.007 4.006A1 1 0 1 0 2.04 11.47l4.007-4.007 3.778 3.778a1 1 0 0 0 1.415-1.414L7.46 6.048z",clipRule:"evenodd"})))},i=(0,a.forwardRef)(s)},"./node_modules/matrix-react-sdk/src/components/views/beacon/BeaconViewDialog.tsx":(e,t,o)=>{o.r(t),o.d(t,{default:()=>$});var n=o("./node_modules/react/index.js"),a=o("./node_modules/matrix-react-sdk/res/img/location/live-location.svg"),r=o("./node_modules/matrix-js-sdk/src/matrix.ts"),s=o("./node_modules/matrix-react-sdk/src/hooks/useEventEmitter.ts");var i=o("./node_modules/matrix-react-sdk/src/contexts/MatrixClientContext.tsx"),l=o("./node_modules/matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),c=o("./node_modules/matrix-react-sdk/src/components/views/location/Map.tsx"),m=o("./node_modules/matrix-react-sdk/src/components/views/location/ZoomButtons.tsx"),d=o("./node_modules/matrix-react-sdk/src/components/views/location/index.tsx");const u=({map:e,beacon:t,tooltip:o})=>{var a;const l=(0,s.dF)(t,r.BeaconEvent.LocationUpdate,(()=>t.latestLocationState)),c=(0,n.useContext)(i.Ay).getRoom(t.roomId);if(!l||!t.isLive)return null;const m=l.uri||"",u=(null===(a=t.beaconInfo)||void 0===a?void 0:a.assetType)===r.LocationAssetType.Self,v=null==c?void 0:c.getMember(t.beaconInfoOwner),_=u&&v?v:void 0;return n.createElement(d.U3,{map:e,id:t.identifier,geoUri:m,roomMember:_,tooltip:o,useMemberColor:!0})};var v=o("./node_modules/matrix-react-sdk/src/utils/arrays.ts"),_=o("./node_modules/matrix-react-sdk/src/utils/location/index.ts");const p=e=>{const t=(0,v.Bo)(e.map((e=>{var t;return null!==(t=e.latestLocationState)&&void 0!==t&&t.uri?(0,_.XB)(e.latestLocationState.uri):void 0})));if(!t.length)return;const o=[...t].sort(((e,t)=>t.latitude-e.latitude)),n=[...t].sort(((e,t)=>t.longitude-e.longitude));return o.length<1||n.length<1?void 0:{north:o[0].latitude,south:o[o.length-1].latitude,east:n[0].longitude,west:n[n.length-1].longitude}};var x,g=o("./node_modules/matrix-react-sdk/src/utils/beacon/index.ts"),b=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),f=o("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx"),w=o("./node_modules/matrix-react-sdk/res/img/image-view/close.svg"),E=o("./node_modules/matrix-react-sdk/src/components/views/typography/Heading.tsx"),h=o("./node_modules/@babel/runtime/helpers/esm/extends.js"),k=o("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),y=o("./node_modules/matrix-react-sdk/src/utils/humanize.ts"),B=o("./node_modules/matrix-react-sdk/src/utils/NativeEventUtils.ts"),C=o("./node_modules/matrix-react-sdk/src/components/views/avatars/MemberAvatar.tsx"),L=o("./node_modules/matrix-react-sdk/src/components/views/beacon/BeaconStatus.tsx"),S=o("./node_modules/matrix-react-sdk/src/components/views/beacon/displayStatus.ts"),A=o("./node_modules/matrix-react-sdk/src/components/views/beacon/StyledLiveBeaconIcon.tsx"),I=o("./node_modules/@vector-im/compound-web/dist/compound-web.js");function N(){return N=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},N.apply(this,arguments)}var M=function(e,t){return n.createElement("svg",N({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 11 10",role:"presentation","aria-hidden":!0,ref:t},e),x||(x=n.createElement("path",{fill:"none",fillRule:"evenodd",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",d:"M8.5 5.5v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h3M7 .5h3v3M4.5 6 10 .5"})))},O=(0,n.forwardRef)(M);var j=o("./node_modules/matrix-react-sdk/src/components/views/elements/CopyableText.tsx");const D=({latestLocationState:e})=>{const[t,o]=(0,n.useState)();if((0,n.useEffect)((()=>{if(null==e||!e.uri)return;const t=(0,_.XB)(e.uri);o(t)}),[e]),!e||!t)return null;const a=`${t.latitude},${t.longitude}`,r=(0,_.eC)(t);return n.createElement(n.Fragment,null,n.createElement(I.m_,{label:(0,b._t)("timeline|context_menu|open_in_osm")},n.createElement("a",{href:r,target:"_blank",rel:"noreferrer noopener"},n.createElement(O,{className:"mx_ShareLatestLocation_icon"}))),n.createElement(j.A,{className:"mx_ShareLatestLocation_copy",border:!1,getTextToCopy:()=>a}))},R=["beacon"],T=e=>{var t,o;let{beacon:a}=e,l=(0,k.A)(e,R);const c=(0,s.dF)(a,r.BeaconEvent.LocationUpdate,(()=>a.latestLocationState)),m=(0,n.useContext)(i.Ay).getRoom(a.roomId);if(!c||!a.isLive||!m)return null;const d=(null===(t=a.beaconInfo)||void 0===t?void 0:t.assetType)===r.LocationAssetType.Self,u=d?m.getMember(a.beaconInfoOwner):null,v=c.timestamp&&(0,y.P)(c.timestamp)||"";return n.createElement("li",(0,h.A)({className:"mx_BeaconListItem"},l),d?n.createElement(C.A,{className:"mx_BeaconListItem_avatar",member:u,size:"32px"}):n.createElement(A.A,{className:"mx_BeaconListItem_avatarIcon"}),n.createElement("div",{className:"mx_BeaconListItem_info"},n.createElement(L.A,{className:"mx_BeaconListItem_status",beacon:a,label:(null==u?void 0:u.name)||(null===(o=a.beaconInfo)||void 0===o?void 0:o.description)||a.beaconInfoOwner,displayStatus:S.T.Active},n.createElement("div",{className:"mx_BeaconListItem_interactions",onClick:(0,B.Z)((()=>{}))},n.createElement(D,{latestLocationState:c}))),n.createElement("span",{className:"mx_BeaconListItem_lastUpdated"},(0,b._t)("location_sharing|live_update_time",{humanizedUpdateTime:v}))))},F=({beacons:e,onBeaconClick:t,requestClose:o})=>n.createElement("div",{className:"mx_DialogSidebar"},n.createElement("div",{className:"mx_DialogSidebar_header"},n.createElement(E.A,{size:"4"},(0,b._t)("action|view_list")),n.createElement(f.A,{className:"mx_DialogSidebar_closeButton",onClick:o,title:(0,b._t)("location_sharing|close_sidebar")},n.createElement(w.I,{className:"mx_DialogSidebar_closeButtonIcon"}))),null!=e&&e.length?n.createElement("ol",{className:"mx_DialogSidebar_list"},e.map((e=>n.createElement(T,{key:e.identifier,beacon:e,onClick:()=>t(e)})))):n.createElement("div",{className:"mx_DialogSidebar_noResults"},(0,b._t)("location_sharing|live_locations_empty")));var U=o("./node_modules/matrix-react-sdk/src/stores/OwnBeaconStore.ts"),z=o("./node_modules/matrix-react-sdk/src/components/views/beacon/OwnBeaconStatus.tsx");const G=({roomId:e})=>{var t;const o=(e=>(0,s.dF)(U.g.instance,U.q.LivenessChange,(()=>{const[t]=U.g.instance.getLiveBeaconIds(e);return U.g.instance.getBeaconById(t)})))(e),a=(0,n.useContext)(i.Ay).getRoom(e);if(null==o||!o.isLive||!a)return null;const l=(null===(t=o.beaconInfo)||void 0===t?void 0:t.assetType)===r.LocationAssetType.Self,c=l?a.getMember(o.beaconInfoOwner):null;return n.createElement("div",{className:"mx_DialogOwnBeaconStatus"},l?n.createElement(C.A,{className:"mx_DialogOwnBeaconStatus_avatar",member:c,size:"32px"}):n.createElement(A.A,{className:"mx_DialogOwnBeaconStatus_avatarIcon"}),n.createElement(z.A,{className:"mx_DialogOwnBeaconStatus_status",beacon:o,displayStatus:S.T.Active}))},H=({beacon:e})=>{const t=(e=>{var t;const o=(0,n.useContext)(i.Ay);var a;if((null===(t=e.beaconInfo)||void 0===t?void 0:t.assetType)!==r.LocationAssetType.Self)return null===(a=e.beaconInfo)||void 0===a?void 0:a.description;const s=o.getRoom(e.roomId),l=null==s?void 0:s.getMember(e.beaconInfoOwner);return(null==l?void 0:l.rawDisplayName)||e.beaconInfoOwner})(e);return n.createElement("div",{className:"mx_BeaconStatusTooltip"},n.createElement(L.A,{beacon:e,label:t,displayStatus:S.T.Active,displayLiveTimeRemaining:!0,className:"mx_BeaconStatusTooltip_inner"},n.createElement(D,{latestLocationState:e.latestLocationState})))};var Z=o("./node_modules/matrix-react-sdk/src/components/views/location/MapFallback.tsx"),P=o("./node_modules/matrix-react-sdk/src/components/views/location/MapError.tsx");const V=e=>{if(e)return(0,g.mt)({latitude:(e.north+e.south)/2,longitude:(e.east+e.west)/2,timestamp:Date.now()})},$=({initialFocusedBeacon:e,roomId:t,matrixClient:o,onFinished:d})=>{const v=((e,t)=>{const o=t.getRoom(e);return(0,s.dF)(null==o?void 0:o.currentState,r.RoomStateEvent.BeaconLiveness,(()=>{var e;return(null==o||null===(e=o.currentState)||void 0===e?void 0:e.liveBeaconIds.map((e=>o.currentState.beacons.get(e))))||[]}))})(t,o),[_,x]=(0,n.useState)({beacon:e,ts:0}),[g,w]=(0,n.useState)(!1),{bounds:E,centerGeoUri:h}=((e,{beacon:t,ts:o})=>{var a;const[r,s]=(0,n.useState)(p(e)),[i,l]=(0,n.useState)((null==t||null===(a=t.latestLocationState)||void 0===a?void 0:a.uri)||V(r));return(0,n.useEffect)((()=>{var e,n;0!==o&&null!=t&&null!==(e=t.latestLocationState)&&void 0!==e&&e.uri&&(l(`${null==t||null===(n=t.latestLocationState)||void 0===n?void 0:n.uri};mxTs=${Date.now()}`),s(p([t])))}),[t,o]),{bounds:r,centerGeoUri:i}})(v,_),[k,y]=(0,n.useState)();(0,n.useEffect)((()=>{k&&w(!0)}),[k]);const B=v.filter((e=>(null==e?void 0:e.beaconInfoOwner)===o.getUserId())).length>0;return n.createElement(l.A,{className:"mx_BeaconViewDialog",onFinished:d,fixedWidth:!1},n.createElement(i.Ay.Provider,{value:o},h&&!k&&n.createElement(c.default,{id:"mx_BeaconViewDialog",bounds:E,centerGeoUri:h,interactive:!0,onError:y,className:"mx_BeaconViewDialog_map",allowGeolocate:!B},(({map:e})=>n.createElement(n.Fragment,null,v.map((t=>n.createElement(u,{key:t.identifier,map:e,beacon:t,tooltip:n.createElement(H,{beacon:t})}))),n.createElement(m.A,{map:e})))),k instanceof Error&&n.createElement(P.p,{error:k.message,isMinimised:!0}),!h&&!k&&n.createElement(Z.A,{className:"mx_BeaconViewDialog_map"},n.createElement("span",{className:"mx_BeaconViewDialog_mapFallbackMessage"},(0,b._t)("location_sharing|live_locations_empty")),n.createElement(f.A,{kind:"primary",onClick:d},(0,b._t)("action|close"))),g?n.createElement(F,{beacons:v,onBeaconClick:e=>{x({beacon:e,ts:Date.now()})},requestClose:()=>w(!1)}):n.createElement(f.A,{kind:"primary",onClick:()=>w(!0),className:"mx_BeaconViewDialog_viewListButton"},n.createElement(a.I,{height:12})," ",(0,b._t)("action|view_list")),n.createElement(G,{roomId:t})))}},"./node_modules/matrix-react-sdk/src/components/views/location/Map.tsx":(e,t,o)=>{o.r(t),o.d(t,{default:()=>f});var n=o("./node_modules/react/index.js"),a=o("./node_modules/classnames/index.js"),r=o.n(a),s=o("./node_modules/maplibre-gl/dist/maplibre-gl.js"),i=o("./node_modules/matrix-js-sdk/src/matrix.ts"),l=o("./node_modules/matrix-js-sdk/src/logger.ts"),c=o("./node_modules/matrix-react-sdk/src/contexts/MatrixClientContext.tsx"),m=o("./node_modules/matrix-react-sdk/src/hooks/useEventEmitter.ts"),d=o("./node_modules/matrix-react-sdk/src/utils/location/index.ts"),u=o("./node_modules/matrix-react-sdk/src/utils/WellKnownUtils.ts"),v=o("./node_modules/matrix-react-sdk/src/utils/location/map.ts");var _=o("./node_modules/matrix-react-sdk/src/Modal.tsx"),p=o("./node_modules/matrix-react-sdk/src/components/views/dialogs/ErrorDialog.tsx"),x=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx");const g=({id:e,centerGeoUri:t,onError:o,interactive:a,bounds:r,allowGeolocate:_})=>{const p=`mx_Map_${e}`,x=(0,n.useContext)(c.Ay),g=(0,m.dF)(x,i.ClientEvent.ClientWellKnown,(e=>{var t;return null===(t=(0,u.XP)(e))||void 0===t?void 0:t.map_style_url})),f=(({interactive:e,bodyId:t,onError:o})=>{const a=(0,c.nH)(),[r,s]=(0,n.useState)();return(0,n.useEffect)((()=>{try{s((0,v.p)(a,!!e,t,o))}catch(e){console.error("Error encountered in useMap",e),e instanceof Error&&(null==o||o(e))}return()=>{r&&(r.remove(),s(void 0))}}),[e,t,o]),r})({interactive:a,bodyId:p,onError:o});(0,n.useEffect)((()=>{g&&f&&f.setStyle(g)}),[g,f]),(0,n.useEffect)((()=>{if(f&&t)try{const e=(0,d.XB)(t);if(!e)throw new Error("Invalid geo URI");f.setCenter({lon:e.longitude,lat:e.latitude})}catch(e){l.v.error("Could not set map center")}}),[f,t]),(0,n.useEffect)((()=>{if(f&&r)try{const e=new s.LngLatBounds([r.west,r.south],[r.east,r.north]);f.fitBounds(e,{padding:100,maxZoom:15})}catch(e){l.v.error("Invalid map bounds")}}),[f,r]);const[w,E]=(0,n.useState)(null);return(0,n.useEffect)((()=>{if(f){if(_&&!w){const e=new s.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1});E(e),f.addControl(e)}!_&&w&&(f.removeControl(w),E(null))}}),[f,w,_]),(0,n.useEffect)((()=>{if(w)return w.on("error",b),()=>{w.off("error",b)}}),[w]),{map:f,bodyId:p}},b=e=>{var t;l.v.error("Could not fetch location",e),_.Ay.createDialog(p.A,{title:(0,x._t)("location_sharing|error_fetch_location"),description:null!==(t=(0,d.Ff)(e.code))&&void 0!==t?t:""})},f=({bounds:e,centerGeoUri:t,children:o,className:a,allowGeolocate:s,id:i,interactive:l,onError:c,onClick:m})=>{const{map:d,bodyId:u}=g({centerGeoUri:t,onError:c,id:i,interactive:l,bounds:e,allowGeolocate:s});return n.createElement("div",{className:r()("mx_Map",a),id:u,onClick:e=>{e.target.classList.contains("maplibregl-ctrl-attrib-button")||m&&m()}},!!o&&!!d&&o({map:d}))}},"./node_modules/matrix-react-sdk/src/components/views/location/ZoomButtons.tsx":(e,t,o)=>{o.d(t,{A:()=>d});var n,a=o("./node_modules/react/index.js"),r=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),s=o("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx");function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},i.apply(this,arguments)}var l=function(e,t){return a.createElement("svg",i({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0,ref:t},e),n||(n=a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8.783 2.783a.783.783 0 1 0-1.566 0v4.434H2.783a.783.783 0 0 0 0 1.566h4.434v4.435a.783.783 0 0 0 1.566 0V8.783h4.435a.783.783 0 0 0 0-1.566H8.783z",clipRule:"evenodd"})))},c=(0,a.forwardRef)(l);var m=o("./node_modules/matrix-react-sdk/res/img/element-icons/minus-button.svg");const d=({map:e})=>a.createElement("div",{className:"mx_ZoomButtons"},a.createElement(s.A,{onClick:()=>{e.zoomIn()},title:(0,r._t)("action|zoom_in"),className:"mx_ZoomButtons_button"},a.createElement(c,{className:"mx_ZoomButtons_icon"})),a.createElement(s.A,{onClick:()=>{e.zoomOut()},title:(0,r._t)("action|zoom_out"),className:"mx_ZoomButtons_button"},a.createElement(m.I,{className:"mx_ZoomButtons_icon"})))},"./node_modules/matrix-react-sdk/src/utils/location/map.ts":(e,t,o)=>{o.d(t,{h:()=>c,p:()=>l});var n=o("./node_modules/maplibre-gl/dist/maplibre-gl.js"),a=o("./node_modules/matrix-js-sdk/src/logger.ts"),r=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),s=o("./node_modules/matrix-react-sdk/src/utils/location/findMapStyleUrl.ts"),i=o("./node_modules/matrix-react-sdk/src/utils/location/LocationShareErrors.ts");const l=(e,t,o,l)=>{try{const c=(0,s.M)(e),m=new n.Map({container:o,style:c,zoom:15,interactive:t,attributionControl:!1,locale:{"AttributionControl.ToggleAttribution":(0,r._t)("location_sharing|toggle_attribution"),"AttributionControl.MapFeedback":(0,r._t)("location_sharing|map_feedback"),"FullscreenControl.Enter":(0,r._t)("action|enter_fullscreen"),"FullscreenControl.Exit":(0,r._t)("action|exit_fullscreeen"),"GeolocateControl.FindMyLocation":(0,r._t)("location_sharing|find_my_location"),"GeolocateControl.LocationNotAvailable":(0,r._t)("location_sharing|location_not_available"),"LogoControl.Title":(0,r._t)("location_sharing|mapbox_logo"),"NavigationControl.ResetBearing":(0,r._t)("location_sharing|reset_bearing"),"NavigationControl.ZoomIn":(0,r._t)("action|zoom_in"),"NavigationControl.ZoomOut":(0,r._t)("action|zoom_out")}});return m.addControl(new n.AttributionControl,"top-right"),m.on("error",(e=>{a.v.error("Failed to load map: check map_style_url in config.json has a valid URL and API key",e.error),null==l||l(new Error(i.$.MapStyleUrlNotReachable))})),m}catch(e){a.v.error("Failed to render map",e);if((null==e?void 0:e.message).includes("Failed to initialize WebGL"))throw new Error(i.$.WebGLNotEnabled);throw e}},c=(e,t)=>new n.Marker({element:t,anchor:"bottom",offset:[0,-1]}).setLngLat({lon:e.longitude,lat:e.latitude})}}]);
//# sourceMappingURL=8667.js.map